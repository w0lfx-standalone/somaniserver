# v1.4 â€“ Setting up Seafile

This document provides a detailed walkthrough of the setup and configuration of Seafile, a private file syncing and sharing platform, on the `somaniserver`.

## 1. Introduction

Seafile is a self-hosted file-syncing platform with a focus on privacy and data ownership. It provides features similar to Dropbox or Google Drive, but all data is stored on your own server. In this project, Seafile is used to provide a reliable and secure way to sync files across multiple devices, with all data stored on the redundant ZFS pool.

## 2. Prerequisites

Before installing Seafile, ensure the following prerequisites are met:

*   **Ubuntu VM:** A running Ubuntu VM with Docker and Docker Compose installed.
*   **NFS Share:** The `/mnt/swimming_pool/media` NFS share from the TrueNAS VM must be mounted and accessible on the Ubuntu VM.
*   **User and Group:** The `somaniserver` user (UID 3000) and `somanigroup` group (GID 3001) must exist on the Ubuntu VM and have write permissions to the `/mnt/swimming_pool/media` directory.

## 3. Docker Compose Configuration

Seafile is deployed using Docker Compose. A `docker-compose.yml` file is used to define the Seafile server and its dependencies, including a MariaDB database and a Memcached instance for caching.

The configuration is set up to use the existing NFS share for persistent storage. The Seafile container's data volume is mapped to `/mnt/swimming_pool/media/seafile-data`, and the database's volume is mapped to `/mnt/swimming_pool/media/seafile-mysql`. This ensures that all of Seafile's data is stored on the redundant ZFS pool.

Environment variables are used to configure the Seafile server, including the database credentials, admin user, and server hostname.

**[Placeholder for Screenshot 1: Docker Compose file]**
*Caption: The `docker-compose.yml` file for Seafile, showing the service definitions and volume mappings.*

## 4. Systemd Service

To ensure Seafile starts automatically on boot, a `systemd` service is created. The service file, located at `/etc/systemd/system/seafile.service`, is configured to run `docker-compose up -d` on startup and `docker-compose down` on shutdown. The service is set to run as the `somaniserver` user to ensure correct permissions.

**[Placeholder for Screenshot 2: Systemd service file]**
*Caption: The `seafile.service` file, showing the service definition and commands.*

The service is enabled using `sudo systemctl enable seafile.service`.

**[Placeholder for Screenshot 3: Systemd service status]**
*Caption: The output of `systemctl status seafile.service`, showing that the service is active and running.*

## 5. Storage Integration

Seafile's data is stored on the ZFS pool managed by TrueNAS. This provides a high level of data integrity and redundancy. The NFS share allows the Ubuntu VM to access the storage, and the Docker volume mappings ensure that the containerized services can read and write data to the correct location.

## 6. Verification

To verify that Seafile is working correctly, the following steps are taken:

1.  The `seafile.service` is started and its status is checked.
2.  The Docker container logs are inspected for any errors.
3.  The Seafile web UI is accessed and the admin user logs in.
4.  A file is uploaded and then downloaded to test the file syncing functionality.

**[Placeholder for Screenshot 4: Seafile web UI]**
*Caption: The Seafile web interface, showing the file browser after a successful login.*
